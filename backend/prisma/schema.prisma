// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Venue {
  id        Int       @id @default(autoincrement())
  name      String
  address   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
  orders    Order[]
  users     User[]
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  pin       String?
  venueId   Int
  venue     Venue    @relation(fields: [venueId], references: [id])
  role      String   @default("cashier") // cashier, manager, admin
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model ProductType {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  products    Product[]
  createdAt   DateTime  @default(now())
}

model Product {
  id            Int            @id @default(autoincrement())
  name          String
  category      String // beer, wine, cocktail, spirit, signature, non-alcoholic
  price         Float
  imageUrl      String?
  quantity      Int            @default(0) // Inventory quantity
  productTypeId Int?
  productType   ProductType?   @relation(fields: [productTypeId], references: [id])
  venueId       Int
  venue         Venue          @relation(fields: [venueId], references: [id])
  ingredients   Ingredient[]
  orderItems    OrderItem[]
  cartItems     CartItem[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([category])
  @@index([venueId])
}

model Ingredient {
  id          Int      @id @default(autoincrement())
  productId   Int
  product     Product  @relation(fields: [productId], references: [id])
  name        String
  quantity    Float
  servingSize String?
  unit        String   @default("oz")
  createdAt   DateTime @default(now())
}

model Order {
  id            Int         @id @default(autoincrement())
  orderName     String?
  status        String      @default("open") // open, saved, closed, cancelled
  total         Float
  customCharges Float       @default(0)
  venueId       Int
  venue         Venue       @relation(fields: [venueId], references: [id])
  userId        Int?
  user          User?       @relation(fields: [userId], references: [id])
  items         OrderItem[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  closedAt      DateTime?

  @@index([status])
  @@index([venueId])
  @@index([createdAt])
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float // Price at time of order
  createdAt DateTime @default(now())

  @@index([orderId])
}

model CartItem {
  id        Int      @id @default(autoincrement())
  sessionId String // WebSocket session ID
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([sessionId, productId])
  @@index([sessionId])
}

model Session {
  id        String   @id @default(uuid())
  userId    Int?
  deviceId  String?
  token     String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([token])
}

model EventBooking {
  id          Int      @id @default(autoincrement())
  customerName String
  customerEmail String?
  customerPhone String?
  eventDate   DateTime
  guestCount  Int
  packageId   Int?
  package     EventPackage? @relation(fields: [packageId], references: [id])
  status      String   @default("pending") // pending, confirmed, cancelled
  notes       String?
  totalAmount Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([eventDate])
  @@index([status])
}

model EventPackage {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  basePrice   Float // Price per guest
  minGuests   Int            @default(50)
  maxGuests   Int            @default(300)
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  bookings    EventBooking[]
}
